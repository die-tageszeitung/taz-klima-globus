import{s as A,a7 as O,J as Y,H as F,I as U,F as X,K as _,L as G,G as V,A as K,Z}from"./zoom-C5iEDD6R.js";function v(e){return e.toLowerCase().replace(/[,\.]/g,"").replace(/\s+/g,"-").replace(/ä/g,"ae").replace(/ö/g,"oe").replace(/ü/g,"ue").replace(/ß/g,"ss")}function q(e){return e===E?"Beschäftiungsverhältnis mit":e===j?"andere Verbindung":e}let x,S,$,w=[],H=[];function P(e,n){w=e,H=n,ot(),console.log(`Rendering: ${e.length} nodes, ${n.length} edges`);const o=document.getElementById("graph-container"),r=o.clientWidth,i=o.clientHeight;A("#graph-svg").selectAll("*").remove();const s=A("#graph-svg"),a=s.append("g"),l=O().scaleExtent([.1,4]).on("zoom",t=>{a.attr("transform",t.transform)});s.call(l);const c=a.append("defs");c.selectAll("marker").data(["beschäftigt"]).join("marker").attr("id",t=>`arrow-${t}`).attr("viewBox","0 -5 10 10").attr("refX",8).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("fill","#1a4a6b").attr("opacity",.65),S=J(e,n);const h=e.map(t=>Object.assign({},t)),d=n.map(t=>Object.assign({},t)),I=d.filter(t=>t.relationship===y),L=d.filter(t=>t.relationship!==y),f=r/2,m=i/2;x=Y(h).force("link",F(d).id(t=>t.id).distance(t=>t.source.institution||t.target.institution?60:t.relationship===y?80:t.relationship===E?100:130).strength(.3)).force("charge",U().strength(t=>t.institution?-400:-250)).force("center",X(f,m)).force("forceX",_(f).strength(.03)).force("forceY",G(m).strength(.03)).force("collision",V().radius(t=>g(t)+18));const z=a.append("g").selectAll("line").data(I).join("line").attr("class",t=>`link ${M(t.relationship)}`),D=a.append("g").selectAll("line").data(L).join("line").attr("class",t=>`link ${M(t.relationship)}`).attr("marker-end",t=>t.relationship===E?"url(#arrow-beschäftigt)":null),u=a.append("g").selectAll("g").data(h).join("g").attr("class","node").call(K().on("start",(t,p)=>Q(t,p)).on("drag",(t,p)=>tt(t,p)).on("end",(t,p)=>et(t,p))).on("mouseenter",(t,p)=>nt(t,p)).on("mousemove",W).on("mouseleave",rt);u.filter(t=>t.anonymous&&!t.institution).append("circle").attr("r",t=>g(t)).attr("class","anonymous"),u.filter(t=>!t.anonymous&&!t.institution).append("circle").attr("r",t=>g(t)).attr("class","named").attr("data-photo-id",t=>v(t.id)),u.filter(t=>!t.anonymous&&!t.institution).each(function(t){const p=A(this).select("circle"),T=v(t.id),B=`data/faces/${T}.jpg`,b=new Image;b.onload=()=>{c.append("pattern").attr("id",`photo-${T}`).attr("patternUnits","objectBoundingBox").attr("width",1).attr("height",1).append("image").attr("href",B).attr("width",40).attr("height",40).attr("x",-6).attr("y",-6).attr("preserveAspectRatio","xMidYMid slice"),p.style("fill",`url(#photo-${T})`)},b.onerror=()=>{},b.src=B}),u.filter(t=>t.institution).append("rect").attr("class","institution").attr("width",20).attr("height",20).attr("x",-10).attr("y",-10).attr("transform","rotate(45)"),u.filter(t=>!t.anonymous&&!t.institution).append("text").attr("dy",t=>g(t)+12).text(t=>k(t.name,20)),u.filter(t=>t.anonymous).append("text").attr("class","anon-label").attr("dy",t=>g(t)+10).text(t=>k(t.name,20)),u.filter(t=>t.institution).append("text").attr("class","institution-label").attr("dy",24).text(t=>k(t.name,18)),x.on("tick",()=>{z.attr("x1",t=>t.source.x).attr("y1",t=>t.source.y).attr("x2",t=>t.target.x).attr("y2",t=>t.target.y),D.attr("x1",t=>t.source.x).attr("y1",t=>t.source.y).attr("x2",t=>N(t).x).attr("y2",t=>N(t).y),u.attr("transform",t=>`translate(${t.x},${t.y})`)})}function g(e){return e.institution?18:e.anonymous?7:14}function k(e,n){return e.length>n?e.slice(0,n-1)+"…":e}function M(e){return e===st?"familiäre-verbindung":e===E?"beschäftigt":e===y?"mitglied":e===j?"nahestehend":"unknown"}function N(e){const n=e.target.x-e.source.x,o=e.target.y-e.source.y,r=Math.sqrt(n*n+o*o)||1,i=g(e.target)+4;return{x:e.target.x-n/r*i,y:e.target.y-o/r*i}}function J(e,n){const o=new Map;return e.forEach(r=>o.set(r.id,[])),n.forEach(r=>{o.has(r.source)&&o.get(r.source).push({other:r.target,relationship:r.relationship}),o.has(r.target)&&o.get(r.target).push({other:r.source,relationship:r.relationship})}),o}function Q(e,n){e.active||x.alphaTarget(.3).restart(),n.fx=n.x,n.fy=n.y}function tt(e,n){n.fx=e.x,n.fy=e.y}function et(e,n){e.active||x.alphaTarget(0),n.fx=null,n.fy=null}function nt(e,n){const o=document.getElementById("tooltip");document.getElementById("tip-name").textContent=n.name;const r=S.get(n.id)||[],i=document.getElementById("tip-connections");i.innerHTML="",r.length===0?i.textContent="Keine Verbindungen":r.forEach(s=>{const a=document.createElement("div");a.className="tip-conn-row",a.innerHTML=`<span class="tip-conn-type">${q(s.relationship)}:</span> ${s.other.replace(/^[?!]/,"")}`,i.appendChild(a)}),o.style.opacity="1",W(e)}function W(e){const n=document.getElementById("tooltip"),o=e.pageX+14,r=e.pageY-10,i=window.innerWidth-n.offsetWidth-10;n.style.left=Math.min(o,i)+"px",n.style.top=r+"px"}function rt(){document.getElementById("tooltip").style.opacity="0"}function ot(){const n=new URLSearchParams(window.location.search).get("center");if(n){const o=document.getElementById("graph-container"),r=o.clientWidth,i=o.clientHeight,s=r/2,a=i/2;for(const l of w)if(l.id===n){l.fx=s,l.fy=a,setTimeout(()=>{Z(".node circle, .node rect").classed("highlighted",c=>c.id===l.id)},500),console.log("Centered on:",l.name);break}}}window.addEventListener("resize",()=>{clearTimeout($),$=setTimeout(()=>{w.length>0&&P(w,H)},250)});const it="https://gist.githubusercontent.com/LalonSander/69fbac7123b1149309c11681e19928c5/raw/afd_netzwerk.csv",st="familiäre Verbindung",E="beschäftigt",y="Mitglied",j="nahestehend";let R=[],C=[];function pt(){console.log("Initializing AfD Network Visualization"),at()}async function at(){const e=document.getElementById("empty-state"),n=document.getElementById("empty-title"),o=document.getElementById("empty-body");try{e.style.display="flex",n.textContent="Daten werden geladen…",o.textContent="Verbindung wird hergestellt.";const r=await fetch(it);if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);const i=await r.text();if(i.trimStart().startsWith("<!DOCTYPE")||i.trimStart().startsWith("<html"))throw new Error("Ungültiges Datenformat erhalten.");const s=ct(i);if(s.skippedRows.length>0&&console.warn("Übersprungene Zeilen:",s.skippedRows),s.nodes.length===0)throw new Error("Keine gültigen Einträge gefunden.");R=s.nodes,C=s.edges,e.style.display="none",P(R,C)}catch(r){console.error("Fehler beim Laden:",r),n.textContent="Fehler beim Laden",o.textContent=r.message,e.style.display="flex"}}function ct(e){const n=e.split(`
`),o=new Map,r=[],i=[];for(let s=1;s<n.length;s++){const a=n[s].trim();if(!a)continue;const l=lt(a);if(l.length<3){i.push({line:s+1,reason:"Nicht genug Spalten",raw:a});continue}const c=l[0].trim(),h=l[1].trim(),d=l[2].trim();if(!c||!d||!h){i.push({line:s+1,reason:"Leere Felder",raw:a});continue}const I=c.startsWith("?"),L=c.startsWith("!"),f=d.startsWith("?"),m=d.startsWith("!");o.has(c)||o.set(c,{id:c,name:c.replace(/^[?!]/,""),anonymous:I,institution:L}),o.has(d)||o.set(d,{id:d,name:d.replace(/^[?!]/,""),anonymous:f,institution:m}),r.push({source:c,target:d,relationship:h})}return console.log(`Parsed: ${o.size} nodes, ${r.length} edges`),{nodes:Array.from(o.values()),edges:r,skippedRows:i}}function lt(e){const n=[];let o="",r=!1;for(let i=0;i<e.length;i++){const s=e[i];s==='"'?r=!r:s===","&&!r?(n.push(o),o=""):o+=s}return n.push(o),n}export{E as RELATIONSHIP_EMPLOY,st as RELATIONSHIP_FAMILIAL,y as RELATIONSHIP_MITGLIED,j as RELATIONSHIP_NAHESTEHEND,pt as initializeApp};
