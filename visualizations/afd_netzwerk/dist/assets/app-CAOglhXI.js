import{s as N,a9 as F,M as G,K as q,L as K,I as Q,N as J,O as Z,J as tt,E as et}from"./zoom-CgdhINo6.js";function S(e){return e.toLowerCase().replace(/[,\.]/g,"").replace(/\s+/g,"-").replace(/ä/g,"ae").replace(/ö/g,"oe").replace(/ü/g,"ue").replace(/ß/g,"ss")}function nt(e){return e===I?"Beschäftiungsverhältnis mit":e===V?"andere Verbindung":e}let M,O,H,v=[],U=[];function Y(e,n){v=e,U=n,pt(),console.log(`Rendering: ${e.length} nodes, ${n.length} edges`);const r=document.getElementById("graph-container"),o=r.clientWidth,i=r.clientHeight;N("#graph-svg").selectAll("*").remove();const s=N("#graph-svg"),a=s.append("g"),u=F().scaleExtent([.1,4]).on("zoom",t=>{a.attr("transform",t.transform)});s.call(u);const c=a.append("defs");c.selectAll("marker").data(["beschäftigt"]).join("marker").attr("id",t=>`arrow-${t}`).attr("viewBox","0 -5 10 10").attr("refX",8).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("fill","#1a4a6b").attr("opacity",.65),O=rt(e,n);const d=e.map(t=>Object.assign({},t)),l=n.map(t=>Object.assign({},t)),h=new Map;for(const t of l){const p=typeof t.source=="object"?t.source.id:t.source,m=typeof t.target=="object"?t.target.id:t.target,$=[p,m].sort().join("||");h.set($,(h.get($)||0)+1)}const x=new Set([...h.entries()].filter(([,t])=>t>1).map(([t])=>t));function f(t){const p=typeof t.source=="object"?t.source.id:t.source,m=typeof t.target=="object"?t.target.id:t.target;return x.has([p,m].sort().join("||"))}const w=l.filter(t=>t.relationship===A),b=l.filter(t=>t.relationship!==A),k=b.filter(t=>!f(t)),L=b.filter(t=>f(t)),E=o/2,T=i/2;M=G(d).force("link",q(l).id(t=>t.id).distance(t=>t.source.institution||t.target.institution?60:t.relationship===A?80:t.relationship===I?100:130).strength(.3)).force("charge",K().strength(t=>t.institution?-400:-250)).force("center",Q(E,T)).force("forceX",J(E).strength(.03)).force("forceY",Z(T).strength(.03)).force("collision",tt().radius(t=>y(t)+18));const B=a.append("g").selectAll("line").data(w).join("line").attr("class",t=>`link ${P(t.relationship)}`),j=a.append("g").selectAll("line").data(k).join("line").attr("class",t=>`link ${P(t.relationship)}`).attr("marker-end",t=>t.relationship===I?"url(#arrow-beschäftigt)":null),X=a.append("g").selectAll("path").data(L).join("path").attr("class",t=>`link ${P(t.relationship)}`).attr("marker-end",t=>t.relationship===I?"url(#arrow-beschäftigt)":null),g=a.append("g").selectAll("g").data(d).join("g").attr("class","node").call(et().on("start",(t,p)=>st(t,p)).on("drag",(t,p)=>it(t,p)).on("end",(t,p)=>at(t,p))).on("mouseenter",(t,p)=>ct(t,p)).on("mousemove",_).on("mouseleave",lt);g.filter(t=>t.anonymous&&!t.institution).append("circle").attr("r",t=>y(t)).attr("class","anonymous"),g.filter(t=>!t.anonymous&&!t.institution).append("circle").attr("r",t=>y(t)).attr("class","named").attr("data-photo-id",t=>S(t.id)),g.filter(t=>!t.anonymous&&!t.institution).each(function(t){const p=N(this).select("circle"),m=S(t.id),$=`data/faces/${m}.jpg`,R=new Image;R.onload=()=>{t.hasPhoto=!0,c.append("pattern").attr("id",`photo-${m}`).attr("patternUnits","objectBoundingBox").attr("width",1).attr("height",1).append("image").attr("href",$).attr("width",40).attr("height",40).attr("x",-6).attr("y",-6).attr("preserveAspectRatio","xMidYMid slice"),p.style("fill",`url(#photo-${m})`)},R.src=$}),g.filter(t=>t.institution).append("rect").attr("class","institution").attr("width",20).attr("height",20).attr("x",-10).attr("y",-10).attr("transform","rotate(45)"),g.filter(t=>!t.anonymous&&!t.institution).append("text").attr("dy",t=>y(t)+12).text(t=>C(t.name,20)),g.filter(t=>t.anonymous).append("text").attr("class","anon-label").attr("dy",t=>y(t)+10).text(t=>C(t.name,20)),g.filter(t=>t.institution).append("text").attr("class","institution-label").attr("dy",24).text(t=>C(t.name,18)),M.on("tick",()=>{B.attr("x1",t=>t.source.x).attr("y1",t=>t.source.y).attr("x2",t=>t.target.x).attr("y2",t=>t.target.y),j.attr("x1",t=>t.source.x).attr("y1",t=>t.source.y).attr("x2",t=>W(t).x).attr("y2",t=>W(t).y),X.attr("d",t=>ot(t)),g.attr("transform",t=>`translate(${t.x},${t.y})`)})}function y(e){return e.institution?18:e.anonymous?7:14}function C(e,n){return e.length>n?e.slice(0,n-1)+"…":e}function P(e){return e===dt?"familiäre-verbindung":e===I?"beschäftigt":e===A?"mitglied":e===V?"nahestehend":"unknown"}function W(e){const n=e.target.x-e.source.x,r=e.target.y-e.source.y,o=Math.sqrt(n*n+r*r)||1,i=y(e.target)+4;return{x:e.target.x-n/o*i,y:e.target.y-r/o*i}}function ot(e){const n=e.source.x,r=e.source.y,o=e.target.x,i=e.target.y,s=(n+o)/2,a=(r+i)/2,u=o-n,c=i-r,d=Math.sqrt(u*u+c*c)||1,l=-c/d,h=u/d,x=40,f=e.relationship===I?-1:1,w=s+l*x*f,b=a+h*x*f,k=y(e.target)+4,L=o-w,E=i-b,T=Math.sqrt(L*L+E*E)||1,B=o-L/T*k,j=i-E/T*k;return`M${n},${r} Q${w},${b} ${B},${j}`}function rt(e,n){const r=new Map;return e.forEach(o=>r.set(o.id,[])),n.forEach(o=>{r.has(o.source)&&r.get(o.source).push({other:o.target,relationship:o.relationship}),r.has(o.target)&&r.get(o.target).push({other:o.source,relationship:o.relationship})}),r}function st(e,n){e.active||M.alphaTarget(.3).restart(),n.fx=n.x,n.fy=n.y}function it(e,n){n.fx=e.x,n.fy=e.y}function at(e,n){e.active||M.alphaTarget(0),n.fx=null,n.fy=null}function ct(e,n){const r=document.getElementById("tooltip");document.getElementById("tip-name").textContent=n.name;const o=O.get(n.id)||[],i=document.getElementById("tip-connections");i.innerHTML="",o.length===0?i.textContent="Keine Verbindungen":o.forEach(s=>{const a=document.createElement("div");a.className="tip-conn-row";const u=typeof s.other=="object"?s.other.name:s.other.replace(/^[?!]/,"");a.innerHTML=`<span class="tip-conn-type">${nt(s.relationship)}:</span> ${u}`,i.appendChild(a)}),r.style.opacity="1",_(e)}function _(e){const n=document.getElementById("tooltip"),r=e.pageX+14,o=e.pageY-10,i=window.innerWidth-n.offsetWidth-10;n.style.left=Math.min(r,i)+"px",n.style.top=o+"px"}function lt(){document.getElementById("tooltip").style.opacity="0"}function pt(){const n=new URLSearchParams(window.location.search).get("center");if(!n)return;const r=document.getElementById("graph-container"),o=r.clientWidth/2,i=r.clientHeight/2;for(const s of v)if(s.id===n){s.fx=o,s.fy=i,console.log("Centered on:",s.name);break}}window.addEventListener("resize",()=>{clearTimeout(H),H=setTimeout(()=>{v.length>0&&Y(v,U)},250)});const ut="https://gist.githubusercontent.com/LalonSander/69fbac7123b1149309c11681e19928c5/raw/afd_netzwerk.csv",dt="familiäre Verbindung",I="beschäftigt",A="Mitglied",V="nahestehend";let z=[],D=[];function yt(){console.log("Initializing AfD Network Visualization"),gt()}async function gt(){const e=document.getElementById("empty-state"),n=document.getElementById("empty-title"),r=document.getElementById("empty-body");try{e.style.display="flex",n.textContent="Daten werden geladen…",r.textContent="Verbindung wird hergestellt.";const o=await fetch(ut);if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);const i=await o.text();if(i.trimStart().startsWith("<!DOCTYPE")||i.trimStart().startsWith("<html"))throw new Error("Ungültiges Datenformat erhalten.");const s=ht(i);if(s.skippedRows.length>0&&console.warn("Übersprungene Zeilen:",s.skippedRows),s.nodes.length===0)throw new Error("Keine gültigen Einträge gefunden.");z=s.nodes,D=s.edges,e.style.display="none",Y(z,D)}catch(o){console.error("Fehler beim Laden:",o),n.textContent="Fehler beim Laden",r.textContent=o.message,e.style.display="flex"}}function ht(e){const n=e.split(`
`),r=new Map,o=[],i=[];for(let s=1;s<n.length;s++){const a=n[s].trim();if(!a)continue;const u=ft(a);if(u.length<3){i.push({line:s+1,reason:"Nicht genug Spalten",raw:a});continue}const c=u[0].trim(),d=u[1].trim(),l=u[2].trim();if(!c||!l||!d){i.push({line:s+1,reason:"Leere Felder",raw:a});continue}const h=c.startsWith("?"),x=c.startsWith("!"),f=l.startsWith("?"),w=l.startsWith("!");r.has(c)||r.set(c,{id:c,name:c.replace(/^[?!]/,""),anonymous:h,institution:x}),r.has(l)||r.set(l,{id:l,name:l.replace(/^[?!]/,""),anonymous:f,institution:w}),o.push({source:c,target:l,relationship:d})}return console.log(`Parsed: ${r.size} nodes, ${o.length} edges`),{nodes:Array.from(r.values()),edges:o,skippedRows:i}}function ft(e){const n=[];let r="",o=!1;for(let i=0;i<e.length;i++){const s=e[i];s==='"'?o=!o:s===","&&!o?(n.push(r),r=""):r+=s}return n.push(r),n}export{I as RELATIONSHIP_EMPLOY,dt as RELATIONSHIP_FAMILIAL,A as RELATIONSHIP_MITGLIED,V as RELATIONSHIP_NAHESTEHEND,yt as initializeApp};
