import{s as b,a7 as P,J as W,H as z,I as j,F as D,K as O,L as Y,G as F,A as X,Z as _}from"./zoom-C5iEDD6R.js";function G(e){return e===E?"Beschäftiungsverhältnis mit":e===H?"andere Verbindung":e}let x,$,A,w=[],M=[];function R(e,n){w=e,M=n,Q(),console.log(`Rendering: ${e.length} nodes, ${n.length} edges`);const i=document.getElementById("graph-container"),o=i.clientWidth,r=i.clientHeight;b("#graph-svg").selectAll("*").remove();const s=b("#graph-svg"),a=s.append("g"),l=P().scaleExtent([.1,4]).on("zoom",t=>{a.attr("transform",t.transform)});s.call(l),a.append("defs").selectAll("marker").data(["beschäftigt"]).join("marker").attr("id",t=>`arrow-${t}`).attr("viewBox","0 -5 10 10").attr("refX",8).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("fill","#1a4a6b").attr("opacity",.65),$=V(e,n);const c=e.map(t=>Object.assign({},t)),p=n.map(t=>Object.assign({},t)),d=p.filter(t=>t.relationship===y),I=p.filter(t=>t.relationship!==y),f=o/2,m=r/2;x=W(c).force("link",z(p).id(t=>t.id).distance(t=>t.source.institution||t.target.institution?60:t.relationship===y?80:t.relationship===E?100:130).strength(.3)).force("charge",j().strength(t=>t.institution?-400:-250)).force("center",D(f,m)).force("forceX",O(f).strength(.03)).force("forceY",Y(m).strength(.03)).force("collision",F().radius(t=>h(t)+18));const T=a.append("g").selectAll("line").data(d).join("line").attr("class",t=>`link ${k(t.relationship)}`),S=a.append("g").selectAll("line").data(I).join("line").attr("class",t=>`link ${k(t.relationship)}`).attr("marker-end",t=>t.relationship===E?"url(#arrow-beschäftigt)":null),g=a.append("g").selectAll("g").data(c).join("g").attr("class","node").call(X().on("start",(t,u)=>U(t,u)).on("drag",(t,u)=>K(t,u)).on("end",(t,u)=>Z(t,u))).on("mouseenter",(t,u)=>q(t,u)).on("mousemove",C).on("mouseleave",J);g.filter(t=>!t.institution).append("circle").attr("r",t=>h(t)).attr("class",t=>t.anonymous?"anonymous":"named"),g.filter(t=>t.institution).append("rect").attr("class","institution").attr("width",20).attr("height",20).attr("x",-10).attr("y",-10).attr("transform","rotate(45)"),g.filter(t=>!t.anonymous&&!t.institution).append("text").attr("dy",t=>h(t)+12).text(t=>L(t.name,20)),g.filter(t=>t.anonymous).append("text").attr("class","anon-label").attr("dy",t=>h(t)+10).text(t=>L(t.name,20)),g.filter(t=>t.institution).append("text").attr("class","institution-label").attr("dy",24).text(t=>L(t.name,18)),x.on("tick",()=>{T.attr("x1",t=>t.source.x).attr("y1",t=>t.source.y).attr("x2",t=>t.target.x).attr("y2",t=>t.target.y),S.attr("x1",t=>t.source.x).attr("y1",t=>t.source.y).attr("x2",t=>v(t).x).attr("y2",t=>v(t).y),g.attr("transform",t=>`translate(${t.x},${t.y})`)})}function h(e){return e.institution?18:e.anonymous?7:14}function L(e,n){return e.length>n?e.slice(0,n-1)+"…":e}function k(e){return e===et?"familiäre-verbindung":e===E?"beschäftigt":e===y?"mitglied":e===H?"nahestehend":"unknown"}function v(e){const n=e.target.x-e.source.x,i=e.target.y-e.source.y,o=Math.sqrt(n*n+i*i)||1,r=h(e.target)+4;return{x:e.target.x-n/o*r,y:e.target.y-i/o*r}}function V(e,n){const i=new Map;return e.forEach(o=>i.set(o.id,[])),n.forEach(o=>{i.has(o.source)&&i.get(o.source).push({other:o.target,relationship:o.relationship}),i.has(o.target)&&i.get(o.target).push({other:o.source,relationship:o.relationship})}),i}function U(e,n){e.active||x.alphaTarget(.3).restart(),n.fx=n.x,n.fy=n.y}function K(e,n){n.fx=e.x,n.fy=e.y}function Z(e,n){e.active||x.alphaTarget(0),n.fx=null,n.fy=null}function q(e,n){const i=document.getElementById("tooltip");document.getElementById("tip-name").textContent=n.name;const o=$.get(n.id)||[],r=document.getElementById("tip-connections");r.innerHTML="",o.length===0?r.textContent="Keine Verbindungen":o.forEach(s=>{const a=document.createElement("div");a.className="tip-conn-row",a.innerHTML=`<span class="tip-conn-type">${G(s.relationship)}:</span> ${s.other.replace(/^[?!]/,"")}`,r.appendChild(a)}),i.style.opacity="1",C(e)}function C(e){const n=document.getElementById("tooltip"),i=e.pageX+14,o=e.pageY-10,r=window.innerWidth-n.offsetWidth-10;n.style.left=Math.min(i,r)+"px",n.style.top=o+"px"}function J(){document.getElementById("tooltip").style.opacity="0"}function Q(){const n=new URLSearchParams(window.location.search).get("center");if(n){const i=document.getElementById("graph-container"),o=i.clientWidth,r=i.clientHeight,s=o/2,a=r/2;for(const l of w)if(l.id===n){l.fx=s,l.fy=a,setTimeout(()=>{_(".node circle, .node rect").classed("highlighted",c=>c.id===l.id)},500),console.log("Centered on:",l.name);break}}}window.addEventListener("resize",()=>{clearTimeout(A),A=setTimeout(()=>{w.length>0&&R(w,M)},250)});const tt="https://gist.githubusercontent.com/LalonSander/69fbac7123b1149309c11681e19928c5/raw/afd_netzwerk.csv",et="familiäre Verbindung",E="beschäftigt",y="Mitglied",H="nahestehend";let B=[],N=[];function st(){console.log("Initializing AfD Network Visualization"),nt()}async function nt(){const e=document.getElementById("empty-state"),n=document.getElementById("empty-title"),i=document.getElementById("empty-body");try{e.style.display="flex",n.textContent="Daten werden geladen…",i.textContent="Verbindung wird hergestellt.";const o=await fetch(tt);if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);const r=await o.text();if(r.trimStart().startsWith("<!DOCTYPE")||r.trimStart().startsWith("<html"))throw new Error("Ungültiges Datenformat erhalten.");const s=ot(r);if(s.skippedRows.length>0&&console.warn("Übersprungene Zeilen:",s.skippedRows),s.nodes.length===0)throw new Error("Keine gültigen Einträge gefunden.");B=s.nodes,N=s.edges,e.style.display="none",R(B,N)}catch(o){console.error("Fehler beim Laden:",o),n.textContent="Fehler beim Laden",i.textContent=o.message,e.style.display="flex"}}function ot(e){const n=e.split(`
`),i=new Map,o=[],r=[];for(let s=1;s<n.length;s++){const a=n[s].trim();if(!a)continue;const l=it(a);if(l.length<3){r.push({line:s+1,reason:"Nicht genug Spalten",raw:a});continue}const c=l[0].trim(),p=l[1].trim(),d=l[2].trim();if(!c||!d||!p){r.push({line:s+1,reason:"Leere Felder",raw:a});continue}const I=c.startsWith("?"),f=c.startsWith("!"),m=d.startsWith("?"),T=d.startsWith("!");i.has(c)||i.set(c,{id:c,name:c.replace(/^[?!]/,""),anonymous:I,institution:f}),i.has(d)||i.set(d,{id:d,name:d.replace(/^[?!]/,""),anonymous:m,institution:T}),o.push({source:c,target:d,relationship:p})}return console.log(`Parsed: ${i.size} nodes, ${o.length} edges`),{nodes:Array.from(i.values()),edges:o,skippedRows:r}}function it(e){const n=[];let i="",o=!1;for(let r=0;r<e.length;r++){const s=e[r];s==='"'?o=!o:s===","&&!o?(n.push(i),i=""):i+=s}return n.push(i),n}export{E as RELATIONSHIP_EMPLOY,et as RELATIONSHIP_FAMILIAL,y as RELATIONSHIP_MITGLIED,H as RELATIONSHIP_NAHESTEHEND,st as initializeApp};
